---========================================================--
--==============  THAIDUI HUB V3.8 ‚Äì ·ªîN ƒê·ªäNH T·ªêI ƒêA  =====--
--========================================================--
-- Chuy·ªÉn sang UI t·ª± vi·∫øt (Kh√¥ng ph·ª• thu·ªôc v√†o loadstring UI Library b√™n ngo√†i)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- CONFIG
local UI_NAME = "THAIDUI_V3_8"
local TOGGLE_KEY = Enum.KeyCode.K
local DEFAULT_THEME = {
    Primary = Color3.fromRGB(56,20,100), -- purple mid
    Accent  = Color3.fromRGB(170,84,255), -- purple light
    Text    = Color3.fromRGB(240,240,255),
    Bg      = Color3.fromRGB(12,8,20)
}

-- remove old GUI if rerun
local existing = PlayerGui:FindFirstChild(UI_NAME)
if existing then existing:Destroy() end

-- Helper
local function New(class, props)
    local obj = Instance.new(class)
    if props then
        for k,v in pairs(props) do
            if k == "Parent" then obj.Parent = v else pcall(function() obj[k] = v end) end
        end
    end
    return obj
end

-- Log Console Handler
local logHistory = {}
local logTextLabel 
local function Log(message, type_ = "INFO")
    local prefix = ""
    local color = Color3.fromRGB(240, 240, 255)
    if type_ == "ERROR" then prefix = "üî¥ [ERROR] "; color = Color3.fromRGB(255, 60, 60)
    elseif type_ == "SUCCESS" then prefix = "üü¢ [SUCCESS] "; color = Color3.fromRGB(60, 255, 60)
    elseif type_ == "WARN" then prefix = "‚ö†Ô∏è [WARN] "; color = Color3.fromRGB(255, 200, 50)
    end

    local logEntry = string.format("<font color='#%s'>%s%s</font>", color:ToHex(), prefix, message)
    table.insert(logHistory, logEntry)
    if #logHistory > 10 then table.remove(logHistory, 1) end -- Keep last 10 lines

    if logTextLabel then
        -- C·∫≠p nh·∫≠t log console v·ªõi RichText
        logTextLabel.Text = table.concat(logHistory, "\n")
    end
end

local ScriptStore = {
    -- ===================================
    -- üíé BLOX FRUITS (B·ªî SUNG V√Ä C·∫¨P NH·∫¨T)
    -- ===================================
    {game="Blox Fruits", name="Gravity Hub (Main)", link="https://raw.githubusercontent.com/Dev-GravityHub/BloxFruit/refs/heads/main/Main.lua", code="-- Load link into editor using Fetch button"},
    {game="Blox Fruits", name="BlueX Hub (BF)", link="https://raw.githubusercontent.com/Dev-BlueX/BlueX-Hub/refs/heads/main/Main.lua", code="-- Load link into editor using Fetch button"},
    {game="Blox Fruits", name="Neva Hub (BF)", link="https://raw.githubusercontent.com/NevaHubDEV/Loader/main/NevaBF.lua", code="-- Load link into editor using Fetch button"},
    {game="Blox Fruits", name="Void Hub (BF)", link="https://raw.githubusercontent.com/VoidMasterScript/VoidHub/main/Loader.lua", code="-- Load link into editor using Fetch button"},
    {game="Blox Fruits", name="Fusion Hub (BF)", link="https://raw.githubusercontent.com/FusionHubDev/Fusion/main/BloxFruit.lua", code="-- Load link into editor using Fetch button"},
    {game="Blox Fruits", name="Master Hub (BF)", link="https://raw.githubusercontent.com/KiddoHiru/BloxFruits/main/MasterHub.lua", code="-- Load link into editor using Fetch button"},
    {game="Blox Fruits", name="W-Azure (Paid/Free)", link="https://api.luarmor.net/files/v3/loaders/85e904ae1ff30824c1aa007fc7324f8f.lua", code="-- Load link into editor using Fetch button"},
    {game="Blox Fruits", name="Sakura Hub (BF)", link="https://raw.githubusercontent.com/SakuraScripts/Loader/main/SakuraBF.lua", code="-- Load link into editor using Fetch button"},
    {game="Blox Fruits", name="Kaitun Script", link="https://raw.githubusercontent.com/shinichi-dz/phucshinsayhi/refs/heads/main/KaitunBloxFruit.lua", code="-- Load link into editor using Fetch button"},
    {game="Blox Fruits", name="Quantum Onyx", link="https://raw.githubusercontent.com/flazhy/QuantumOnyx/refs/heads/main/QuantumOnyx.lua", code="-- Load link into editor using Fetch button"},

    -- ===================================
    -- üå± PLANTS VS BRAINROTS (B·ªî SUNG)
    -- ===================================
    {game="Plants vs Brainrots", name="Speed Hub X", link="https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua", code="-- Load link into editor using Fetch button"},
    {game="Plants vs Brainrots", name="Mega Farm (PvB)", link="https://raw.githubusercontent.com/test/Pvb/main/Farm.lua", code="-- Load link into editor using Fetch button"},
    {game="Plants vs Brainrots", name="PvB Cheat (Old)", link="https://pastebin.com/raw/pTfC8t7m", code="-- Load link into editor using Fetch button"},
    {game="Plants vs Brainrots", name="Zetex Hub (PvB)", link="https://raw.githubusercontent.com/Korepi/roblox/main/zetex", code="-- Load link into editor using Fetch button"},
    
    -- ===================================
    -- üöì C∆Ø·ªöP 1 BRAINROTS (B·ªî SUNG)
    -- ===================================
    {game="C∆∞·ªõp 1 Brainrots", name="Luin L·ªõn (Loader)", link="http://luminon.top/loader.lua", code="-- Load link into editor using Fetch button"},
    {game="C∆∞·ªõp 1 Brainrots", name="Luin Nh·ªè (Mini)", link="http://luminon.top/mini.lua", code="-- Load link into editor using Fetch button"},
    {game="C∆∞·ªõp 1 Brainrots", name="Theft Hub (Loader)", link="https://raw.githubusercontent.com/TheftHub/Loader/main/Loader.lua", code="-- Load link into editor using Fetch button"},
    {game="C∆∞·ªõp 1 Brainrots", name="Vietnam Hub (C1B)", link="https://raw.githubusercontent.com/replit8173/VietnamHub/refs/heads/main/VietnamseHub.lua", code="-- Load link into editor using Fetch button"},
}

local Theme = { Primary=DEFAULT_THEME.Primary, Accent=DEFAULT_THEME.Accent, Text=DEFAULT_THEME.Text, Bg=DEFAULT_THEME.Bg }
local currentTransparency = 0.06 

-- Save/Load helpers (Gi·ªØ nguy√™n)
local function ExportScripts()
    local ok, txt = pcall(function() return HttpService:JSONEncode(ScriptStore) end)
    if ok then return txt else return nil end
end

local function ImportScripts(json)
    local ok, tbl = pcall(function() return HttpService:JSONDecode(json) end)
    if ok and type(tbl)=="table" then
        ScriptStore = tbl
        return true
    end
    return false
end

-- Build ScreenGui
local screenGui = New("ScreenGui", {Name = UI_NAME, Parent = PlayerGui, ResetOnSpawn=false, ZIndexBehavior=Enum.ZIndexBehavior.Sibling})

-- Blur in Lighting
local Lighting = game:GetService("Lighting")
local blur = Lighting:FindFirstChild("THAIDUI_Blur")
if not blur then
    blur = New("BlurEffect", {Parent = Lighting, Name = "THAIDUI_Blur", Size = 0})
end

-- Main window
local Main = New("Frame", {
    Parent = screenGui,
    Name = "MainWindow",
    Size = UDim2.new(0, 900, 0, 600), 
    Position = UDim2.new(0.5, -450, 0.5, -300),
    BackgroundColor3 = Theme.Bg,
    BackgroundTransparency = currentTransparency,
    BorderSizePixel = 0,
    ZIndex = 50
})
New("UICorner", {Parent = Main, CornerRadius = UDim.new(0,14)})
local mainStroke = New("UIStroke", {Parent = Main, Color = Theme.Primary, Transparency = 0.85, Thickness = 1})

Main.Active = true
Main.Draggable = true

-- Top title + glowing text
local Title = New("TextLabel", {Parent = Main, Size = UDim2.new(1,0,0,56), BackgroundTransparency=1, Text="THAIDUI V3.8", Font=Enum.Font.GothamBlack, TextSize=26, TextColor3=Theme.Text, ZIndex=51, TextXAlignment=Enum.TextXAlignment.Left, Position=UDim2.new(0,20,0,12)})
local Sub = New("TextLabel", {Parent = Main, Size = UDim2.new(1,-40,0,18), Position = UDim2.new(0,20,0,42), BackgroundTransparency=1, Text="·ªîn ƒë·ªãnh ‚Ä¢ Toggle K ‚Ä¢ T·ª± vi·∫øt UI", Font=Enum.Font.Code, TextSize=12, TextColor3=Theme.Text})
-- glow effect (FIXED using TweenService)
local glow = New("TextLabel", {Parent = Main, Size=Title.Size, Position=Title.Position, BackgroundTransparency=1, Text=Title.Text, Font=Title.Font, TextSize=Title.TextSize, TextColor3=Theme.Accent, TextTransparency=1, ZIndex=50})
local tweenInfo = TweenInfo.new(1.2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true, 0)
local goal = {TextTransparency = 0.4}
local goal2 = {TextTransparency = 1}
TweenService:Create(glow, tweenInfo, goal):Play()
task.wait(0.6)
TweenService:Create(glow, tweenInfo, goal2):Play()


-- Left: Game list
local left = New("Frame", {Parent = Main, Size = UDim2.new(0,220,1,-120), Position = UDim2.new(0,20,0,80), BackgroundTransparency=1})
New("UICorner", {Parent = left, CornerRadius = UDim.new(0,10)})
local leftTitle = New("TextLabel", {Parent = left, Size=UDim2.new(1,0,0,22), BackgroundTransparency=1, Text="Games", Font=Enum.Font.GothamBold, TextSize=14, TextColor3=Theme.Text, TextXAlignment=Enum.TextXAlignment.Left})
local gameListLayout = New("UIListLayout", {Parent = left, Padding=UDim.new(0,8), SortOrder = Enum.SortOrder.LayoutOrder, VerticalAlignment = Enum.VerticalAlignment.Top})


-- Build game list from ScriptStore
local function GetGameList()
    local seen = {}
    for _, s in ipairs(ScriptStore) do
        seen[s.game or "General"] = true
    end
    local games = {}
    for k,_ in pairs(seen) do table.insert(games, k) end
    table.sort(games)
    return games
end

local gameButtons = {}
local selectedGame = nil
local function RefreshScriptList()
    -- show only scripts that match selectedGame (or all if nil)
    for _,c in pairs(scriptList:GetChildren()) do if not c:IsA("UIListLayout") then c:Destroy() end end
    local count = 0
    for i, s in ipairs(ScriptStore) do
        if (not selectedGame) or (s.game == selectedGame) then
            count = count + 1
            local btn = New("TextButton", {Parent = scriptList, Size=UDim2.new(1,-12,0,36), Text = s.name, BackgroundColor3=Theme.Primary, TextColor3=Theme.Text, Font=Enum.Font.Gotham, TextSize=14, LayoutOrder=count})
            New("UICorner", {Parent = btn, CornerRadius = UDim.new(0,8)})
            
            if i == selectedIndex then
                btn.BackgroundColor3 = Theme.Accent
                btn.TextColor3 = Theme.Bg
            end

            btn.MouseButton1Click:Connect(function()
                selectedIndex = i
                nameBox.Text = s.name or ""
                linkBox.Text = s.link or ""
                codeBox.Text = s.code or ""
                RefreshScriptList() -- re-highlight selected button
            end)
        end
    end
    scriptList.CanvasSize = UDim2.new(0,0,0, (count*44)+8)
end

local function RefreshGameButtons()
    for _,c in ipairs(left:GetChildren()) do
        if c.Name == "GameBtn" then c:Destroy() end
    end
    -- Reset selected game if current game list is empty
    if #GetGameList() == 0 then selectedGame = nil end
    
    local games = GetGameList()
    for i,g in ipairs(games) do
        local btn = New("TextButton", {Parent = left, Name="GameBtn", Size=UDim2.new(1,0,0,36), BackgroundColor3=Theme.Primary, AutoButtonColor=true, Text=g, Font=Enum.Font.GothamSemibold, TextSize=14, TextColor3=Theme.Text, LayoutOrder=i+1})
        New("UICorner", {Parent = btn, CornerRadius = UDim.new(0,8)})
        btn.MouseButton1Click:Connect(function()
            selectedGame = g
            -- B·ªè highlight n√∫t c≈©
            for _, c in ipairs(left:GetChildren()) do 
                if c:IsA("TextButton") then c.BackgroundColor3 = Theme.Primary end
            end
            -- Highlight n√∫t m·ªõi
            btn.BackgroundColor3 = Theme.Accent
            RefreshScriptList()
        end)
        if g == selectedGame then btn.BackgroundColor3 = Theme.Accent end -- Highlight the selected game
    end
end

-- Right content: script list + editor + controls
local right = New("Frame", {Parent = Main, Size = UDim2.new(1,-280,1,-120), Position = UDim2.new(0,240,0,80), BackgroundTransparency=1})
New("UICorner", {Parent = right, CornerRadius = UDim.new(0,10)})

-- Script list scroll
local scriptList = New("ScrollingFrame", {Parent = right, Size=UDim2.new(0.36,0,1,0), Position=UDim2.new(0,0,0,0), CanvasSize=UDim2.new(0,0,0,0), ScrollBarThickness=6, BackgroundTransparency=1})
local listLayout = New("UIListLayout", {Parent = scriptList, Padding=UDim.new(0,8), SortOrder = Enum.SortOrder.LayoutOrder})

-- Editor area
local editor = New("Frame", {Parent = right, Size = UDim2.new(0.64, -12, 1, 0), Position = UDim2.new(0.36, 12, 0, 0), BackgroundTransparency=1})
local nameBox = New("TextBox", {Parent = editor, Size = UDim2.new(1,0,0,30), Position=UDim2.new(0,0,0,0), PlaceholderText="Script name", ClearTextOnFocus=false, Text="", BackgroundColor3=Color3.fromRGB(15,10,30)})
New("UICorner", {Parent = nameBox, CornerRadius=UDim.new(0,6)})
local linkBox = New("TextBox", {Parent = editor, Size = UDim2.new(1,0,0,28), Position=UDim2.new(0,0,0,36), PlaceholderText="Optional link (http/https)", ClearTextOnFocus=false, Text="", BackgroundColor3=Color3.fromRGB(15,10,30)})
New("UICorner", {Parent = linkBox, CornerRadius=UDim.new(0,6)})
local codeBox = New("TextBox", {Parent = editor, Size = UDim2.new(1,0,1,-140), Position=UDim2.new(0,0,0,72), MultiLine=true, TextWrapped=true, ClearTextOnFocus=false, Font=Enum.Font.Code, Text="", BackgroundColor3=Color3.fromRGB(10,10,14), TextColor3=Theme.Text, TextSize=12, TextYAlignment=Enum.TextYAlignment.Top})
New("UICorner", {Parent = codeBox, CornerRadius=UDim.new(0,8)})

local btnFetch = New("TextButton", {Parent = editor, Size = UDim2.new(0,140,0,34), Position=UDim2.new(0,0,1,-56), Text="Fetch Link ‚Üí Editor", BackgroundColor3=Theme.Primary, Font=Enum.Font.GothamBold, TextColor3=Theme.Text})
New("UICorner", {Parent = btnFetch, CornerRadius=UDim.new(0,6)})
local btnExecute = New("TextButton", {Parent = editor, Size = UDim2.new(0,120,0,34), Position=UDim2.new(0,152,1,-56), Text="Execute (local)", BackgroundColor3=Theme.Accent, Font=Enum.Font.GothamBold, TextColor3=Theme.Bg})
New("UICorner", {Parent = btnExecute, CornerRadius=UDim.new(0,6)})
local btnSaveScript = New("TextButton", {Parent = editor, Size = UDim2.new(0,70,0,34), Position=UDim2.new(0,284,1,-56), Text="Save", BackgroundColor3=Color3.fromRGB(70,40,120), Font=Enum.Font.GothamBold, TextColor3=Theme.Text})
New("UICorner", {Parent = btnSaveScript, CornerRadius=UDim.new(0,6)})
local btnDeleteScript = New("TextButton", {Parent = editor, Size = UDim2.new(0,60,0,34), Position=UDim2.new(0,364,1,-56), Text="Delete", BackgroundColor3=Color3.fromRGB(180,40,40), Font=Enum.Font.GothamBold, TextColor3=Theme.Text})
New("UICorner", {Parent = btnDeleteScript, CornerRadius=UDim.new(0,6)})


-- Export/Import UI
local btnExport = New("TextButton", {Parent = editor, Size=UDim2.new(0,130,0,28), Position=UDim2.new(0,0,1,-100), Text="Export JSON", BackgroundColor3=Color3.fromRGB(40,40,60), Font=Enum.Font.Gotham, TextColor3=Theme.Text})
New("UICorner", {Parent = btnExport, CornerRadius=UDim.new(0,6)})
local btnImport = New("TextButton", {Parent = editor, Size=UDim2.new(0,130,0,28), Position=UDim2.new(0,140,1,-100), Text="Import JSON", BackgroundColor3=Color3.fromRGB(40,40,60), Font=Enum.Font.Gotham, TextColor3=Theme.Text})
New("UICorner", {Parent = btnImport, CornerRadius=UDim.new(0,6)})

-- Script list rendering & helpers
local selectedIndex = nil

-- initial build
RefreshGameButtons()
RefreshScriptList()

-- Save/Update script from editor to store
btnSaveScript.MouseButton1Click:Connect(function()
    local nm = nameBox.Text:match("^%s*(.-)%s*$") or "Untitled"
    local lk = linkBox.Text:match("^%s*(.-)%s*$") or ""
    local code = codeBox.Text or ""
    local gameName = selectedGame or "General"
    
    if selectedIndex and ScriptStore[selectedIndex] then
        -- C·∫≠p nh·∫≠t
        ScriptStore[selectedIndex].name = nm
        ScriptStore[selectedIndex].link = lk
        ScriptStore[selectedIndex].code = code
        ScriptStore[selectedIndex].game = gameName -- C·∫≠p nh·∫≠t Game Category
        Log("Script updated: " .. nm, "SUCCESS")
    else
        -- Th√™m m·ªõi
        local newIndex = #ScriptStore + 1
        table.insert(ScriptStore, {game = gameName, name = nm, link = lk, code = code})
        selectedIndex = newIndex
        Log("Script added: " .. nm, "SUCCESS")
    end
    RefreshGameButtons()
    RefreshScriptList()
end)

-- Delete script
btnDeleteScript.MouseButton1Click:Connect(function()
    if selectedIndex and ScriptStore[selectedIndex] then
        Log("Script deleted: " .. ScriptStore[selectedIndex].name, "WARN")
        table.remove(ScriptStore, selectedIndex)
        selectedIndex = nil
        nameBox.Text = ""
        linkBox.Text = ""
        codeBox.Text = ""
        RefreshGameButtons()
        RefreshScriptList()
    else
        Log("No script selected to delete.", "INFO")
    end
end)


-- Fetch URL -> Editor (manual fetch; must be fetched before execute)
btnFetch.MouseButton1Click:Connect(function()
    local lk = linkBox.Text or ""
    if lk:match("^https?://") then
        local ok, res = pcall(function() return game:HttpGet(lk) end)
        if ok and res and res ~= "" then
            codeBox.Text = res
            Log("Fetched content into editor (review before Execute).", "SUCCESS")
        else
            Log("Failed to fetch URL or empty content.", "ERROR")
        end
    else
        Log("Invalid URL. Paste a http(s) link in Link box first.", "WARN")
    end
end)

-- Execute button (runs only editor code) - safe wrapper
btnExecute.MouseButton1Click:Connect(function()
    local code = codeBox.Text or ""
    if code:match("^%s*$") then
        Log("Editor is empty. Paste code or fetch it first.", "WARN")
        return
    end
    
    -- compile and run
    local fn, err = loadstring(code)
    if not fn then
        Log("Load error: " .. tostring(err), "ERROR")
        return
    end
    local success, res = pcall(fn)
    if not success then
        Log("Runtime error: "..tostring(res), "ERROR")
    else
        Log("Script executed (local).", "SUCCESS")
    end
end)

-- Export/Import handlers
btnExport.MouseButton1Click:Connect(function()
    local txt = ExportScripts()
    if txt then
        local pop = New("Frame", {Parent = screenGui, Size=UDim2.new(0,600,0,360), Position=UDim2.new(0.5,-300,0.5,-180), BackgroundColor3=Theme.Bg, ZIndex=60})
        New("UICorner", {Parent = pop, CornerRadius=UDim.new(0,8)})
        local tb = New("TextBox", {Parent = pop, Size=UDim2.new(1,-24,1,-44), Position=UDim2.new(0,12,0,12), MultiLine=true, Text=txt, ClearTextOnFocus=false, BackgroundColor3=Color3.fromRGB(15,10,30)})
        local close = New("TextButton", {Parent = pop, Size=UDim2.new(0,80,0,28), Position=UDim2.new(1,-92,1,-36), Text="Close", BackgroundColor3=Color3.fromRGB(70,30,120), TextColor3=Theme.Text})
        New("UICorner", {Parent = close, CornerRadius=UDim.new(0,6)})
        close.MouseButton1Click:Connect(function() pop:Destroy() end)
        Log("Script Store exported to JSON popup.", "INFO")
    else Log("Export failed.", "ERROR") end
end)

btnImport.MouseButton1Click:Connect(function()
    local pop = New("Frame", {Parent = screenGui, Size=UDim2.new(0,600,0,360), Position=UDim2.new(0.5,-300,0.5,-180), BackgroundColor3=Theme.Bg, ZIndex=60})
    New("UICorner", {Parent = pop, CornerRadius=UDim.new(0,8)})
    local tb = New("TextBox", {Parent = pop, Size=UDim2.new(1,-24,1,-44), Position=UDim2.new(0,12,0,12), MultiLine=true, PlaceholderText="Paste JSON here", ClearTextOnFocus=false, BackgroundColor3=Color3.fromRGB(15,10,30)})
    local imp = New("TextButton", {Parent = pop, Size=UDim2.new(0,100,0,28), Position=UDim2.new(1,-112,1,-36), Text="Import", BackgroundColor3=Color3.fromRGB(60,140,80), TextColor3=Theme.Text})
    New("UICorner", {Parent = imp, CornerRadius=UDim.new(0,6)})
    imp.MouseButton1Click:Connect(function()
        local ok = ImportScripts(tb.Text)
        if ok then
            pop:Destroy()
            RefreshGameButtons()
            RefreshScriptList()
            Log("Import successful.", "SUCCESS")
        else Log("Invalid JSON or import failed.", "ERROR") end
    end)
end)

-- Color presets UI (bottom-left)
local cpLabel = New("TextLabel", {Parent = Main, Size=UDim2.new(0,200,0,20), Position=UDim2.new(0,20,1,-36), BackgroundTransparency=1, Text="Theme Presets:", Font=Enum.Font.GothamBold, TextColor3=Theme.Text})
local presets = {
    Purple = {Primary=Color3.fromRGB(56,20,100), Accent=Color3.fromRGB(170,84,255), Text=Color3.fromRGB(240,240,255), Bg=Color3.fromRGB(12,8,20)},
    Pink   = {Primary=Color3.fromRGB(120,20,80), Accent=Color3.fromRGB(255,90,170), Text=Color3.fromRGB(255,240,250), Bg=Color3.fromRGB(18,8,16)},
    Blue   = {Primary=Color3.fromRGB(10,30,80), Accent=Color3.fromRGB(70,160,255), Text=Color3.fromRGB(235,245,255), Bg=Color3.fromRGB(8,10,22)},
    Lava   = {Primary=Color3.fromRGB(80,10,10), Accent=Color3.fromRGB(255,80,60), Text=Color3.fromRGB(255,240,230), Bg=Color3.fromRGB(16,6,6)},
    Clear  = {Primary=Color3.fromRGB(30,30,30), Accent=Color3.fromRGB(200,200,200), Text=Color3.fromRGB(8,8,8), Bg=Color3.fromRGB(8,8,8)} 
}
local function ApplyTheme(themeData)
    Theme.Primary = themeData.Primary; Theme.Accent = themeData.Accent; Theme.Text = themeData.Text; Theme.Bg = themeData.Bg
    Main.BackgroundColor3 = Theme.Bg
    mainStroke.Color = Theme.Primary
    Title.TextColor3 = Theme.Text; Sub.TextColor3 = Theme.Text; glow.TextColor3 = Theme.Accent

    -- Update script list & game buttons
    for _,c in pairs(scriptList:GetChildren()) do if c:IsA("TextButton") then c.BackgroundColor3 = Theme.Primary; c.TextColor3 = Theme.Text end end
    for _,c in pairs(left:GetChildren()) do if c.Name=="GameBtn" then c.BackgroundColor3 = Theme.Primary; c.TextColor3 = Theme.Text end end
    
    -- Update editor buttons
    btnFetch.BackgroundColor3 = Theme.Primary; btnFetch.TextColor3 = Theme.Text
    btnExecute.BackgroundColor3 = Theme.Accent; btnExecute.TextColor3 = Theme.Bg
    btnSaveScript.BackgroundColor3 = Color3.fromRGB(70,40,120); btnSaveScript.TextColor3 = Theme.Text
    btnDeleteScript.BackgroundColor3 = Color3.fromRGB(180,40,40); btnDeleteScript.TextColor3 = Theme.Text
    
    -- Update input fields
    nameBox.BackgroundColor3 = Color3.fromRGB(15,10,30)
    linkBox.BackgroundColor3 = Color3.fromRGB(15,10,30)
    codeBox.BackgroundColor3 = Color3.fromRGB(10,10,14)
    codeBox.TextColor3 = Theme.Text
    
    -- Update Log
    if logTextLabel then logTextLabel.TextColor3 = Theme.Text end
    
    -- Apply transparency to background
    Main.BackgroundTransparency = currentTransparency
    
    RefreshGameButtons() -- re-highlight game button
    RefreshScriptList() -- re-highlight selected button color
end

local px = 0
for k,v in pairs(presets) do
    local b = New("TextButton", {Parent = Main, Size=UDim2.new(0,64,0,28), Position=UDim2.new(0,20+px,1,-68), Text=k, BackgroundColor3=v.Primary, TextColor3=v.Text, Font=Enum.Font.GothamBold})
    New("UICorner", {Parent = b, CornerRadius=UDim.new(0,6)})
    b.MouseButton1Click:Connect(function()
        ApplyTheme(v)
    end)
    px = px + 74
end

-- ===================================
-- Transparency Slider
-- ===================================
local transpSlider = New("TextLabel", {Parent=Main, Size=UDim2.new(0,200,0,20), Position=UDim2.new(0,20,1,-100), BackgroundTransparency=1, Text="Transparency: "..currentTransparency, Font=Enum.Font.GothamBold, TextColor3=Theme.Text, TextXAlignment=Enum.TextXAlignment.Left})
local sliderFrame = New("Frame", {Parent=Main, Size=UDim2.new(0,220,0,10), Position=UDim2.new(0,20,1,-80), BackgroundColor3=Theme.Bg, BorderSizePixel=1, BorderColor3=Color3.fromRGB(40,40,40)})
local fillBar = New("Frame", {Parent=sliderFrame, Size=UDim2.new(currentTransparency,0,1,0), BackgroundColor3=Theme.Accent, BorderSizePixel=0})
local knob = New("TextButton", {Parent=sliderFrame, Size=UDim2.new(0,16,0,16), Position=UDim2.new(currentTransparency, -8, 0.5, -8), BackgroundColor3=Theme.Accent, Text="", BorderSizePixel=0, AutoButtonColor=false})
New("UICorner", {Parent=knob, CornerRadius=UDim.new(0.5,0)})

-- Slider Logic
local dragging = false
knob.MouseButton1Down:Connect(function() dragging = true end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local x = input.Position.X
        local frameX = sliderFrame.AbsolutePosition.X
        local frameWidth = sliderFrame.AbsoluteSize.X
        local ratio = math.clamp((x - frameX) / frameWidth, 0, 1)
        
        currentTransparency = math.floor(ratio * 10) / 10 -- Round to 0.1
        currentTransparency = math.min(0.9, currentTransparency) -- Cap at 0.9 for readability
        
        knob.Position = UDim2.new(currentTransparency, -8, 0.5, -8)
        fillBar.Size = UDim2.new(currentTransparency, 0, 1, 0)
        transpSlider.Text = "Transparency: "..currentTransparency
        Main.BackgroundTransparency = currentTransparency
    end
end)


-- ===================================
-- Log Console
-- ===================================
local logFrame = New("Frame", {Parent = Main, Size = UDim2.new(1,-40,0,40), Position=UDim2.new(0,20,1,-40), BackgroundColor3=Color3.fromRGB(0,0,0), BackgroundTransparency=0.6, ZIndex=50})
logTextLabel = New("TextLabel", {Parent=logFrame, Size=UDim2.new(1,-10,1,0), Position=UDim2.new(0,5,0,0), BackgroundTransparency=1, Text="", Font=Enum.Font.Code, TextSize=11, TextColor3=Theme.Text, TextXAlignment=Enum.TextXAlignment.Left, TextYAlignment=Enum.TextYAlignment.Center, RichText=true})

-- Toggle with key K: show/hide + blur
local visible = true
local function SetVisible(v)
    visible = v
    Main.Visible = v
    TweenService:Create(blur, TweenInfo.new(0.28), {Size = v and 22 or 0}):Play()
    Log("Menu "..(v and "shown (K)" or "hidden (K)"), "INFO")
end
UserInputService.InputBegan:Connect(function(inp, gp)
    if gp then return end
    if inp.KeyCode == TOGGLE_KEY then SetVisible(not visible) end
end)

-- initial
ApplyTheme(DEFAULT_THEME)
RefreshGameButtons()
RefreshScriptList()
SetVisible(true)

Log("THAIDUI V3.8 loaded (T·ª∞ VI·∫æT UI). ·ªîN ƒê·ªäNH T·ªêI ƒêA. Toggle v·ªõi K.", "SUCCESS")
